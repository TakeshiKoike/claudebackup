<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒãƒ™ãƒ«æ•™æãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary-color: #2d5a27;
            --secondary-color: #4a7c43;
            --accent-color: #8bc34a;
            --bg-dark: #1a1a2e;
            --text-light: #fff;
        }

        body {
            font-family: 'Hiragino Sans', 'Noto Sans JP', sans-serif;
            background: var(--bg-dark);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠç”»é¢ */
        #loadScreen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--bg-dark), #16213e);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 5000;
            color: white;
            text-align: center;
        }

        #loadScreen h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        #loadScreen p {
            opacity: 0.8;
            margin-bottom: 40px;
        }

        .load-box {
            background: rgba(255,255,255,0.1);
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
        }

        .load-box h2 {
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .file-input-wrapper {
            margin-bottom: 20px;
        }

        .file-input-wrapper label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .file-input-wrapper input[type="file"] {
            width: 100%;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 10px;
            color: white;
            cursor: pointer;
        }

        .file-input-wrapper input[type="file"]:hover {
            border-color: var(--accent-color);
            background: rgba(255,255,255,0.15);
        }

        #startBtn {
            padding: 15px 50px;
            font-size: 1.2em;
            background: var(--accent-color);
            color: #333;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        #startBtn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(139, 195, 74, 0.4);
        }

        #startBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .demo-btn {
            margin-top: 20px;
            padding: 10px 30px;
            background: transparent;
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .demo-btn:hover {
            border-color: white;
            background: rgba(255,255,255,0.1);
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
        #titleScreen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--bg-dark), #16213e);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            color: white;
            text-align: center;
        }

        #titleScreen h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        #titleScreen h2 {
            font-size: 1.3em;
            font-weight: normal;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .title-info {
            background: rgba(255,255,255,0.1);
            padding: 25px 40px;
            border-radius: 15px;
            margin-bottom: 40px;
            line-height: 1.8;
            text-align: left;
        }

        .title-info p {
            font-size: 0.95em;
            margin: 5px 0;
        }

        #playBtn {
            padding: 20px 60px;
            font-size: 1.4em;
            background: linear-gradient(135deg, #fff, #e8e8e8);
            color: var(--primary-color);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            font-weight: bold;
        }

        #playBtn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ç”»é¢ */
        #gameScreen {
            display: none;
            width: 100%;
            height: 100vh;
            position: relative;
        }

        #backgroundLayer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            background-color: #2d2d44;
            transition: background 0.5s ease;
        }

        #characterLayer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 220px;
            pointer-events: none;
        }

        .character-slot {
            position: absolute;
            bottom: 220px;
            max-width: 300px;
            max-height: 400px;
        }

        .character-slot.left { left: 10%; }
        .character-slot.center { left: 50%; transform: translateX(-50%); }
        .character-slot.right { right: 10%; }

        .character-slot img {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
            border-radius: 10px;
        }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ */
        .character-placeholder {
            width: 200px;
            height: 300px;
            background: linear-gradient(180deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
            border-radius: 100px 100px 20px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 3px solid rgba(255,255,255,0.3);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .character-placeholder.speaking {
            border-color: var(--accent-color);
            box-shadow: 0 10px 40px rgba(139, 195, 74, 0.4);
            transform: scale(1.05);
        }

        .character-placeholder .avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            margin-bottom: 15px;
            border: 4px solid rgba(255,255,255,0.5);
        }

        .character-placeholder .char-name {
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            text-align: center;
            padding: 0 10px;
        }

        .character-placeholder .char-expression {
            color: rgba(255,255,255,0.7);
            font-size: 0.85em;
            margin-top: 5px;
        }

        .character-slot.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* å®Ÿéš›ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒ */
        .character-image {
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
        }

        .character-image img {
            max-width: 280px;
            max-height: 380px;
            object-fit: contain;
            border-radius: 15px;
            filter: drop-shadow(0 8px 25px rgba(0,0,0,0.4));
            transition: all 0.3s ease;
        }

        .character-image.speaking img {
            filter: drop-shadow(0 8px 35px rgba(139, 195, 74, 0.5));
            transform: scale(1.05);
        }

        .character-image .char-label {
            margin-top: 10px;
            padding: 5px 15px;
            background: rgba(0,0,0,0.7);
            color: white;
            border-radius: 15px;
            font-size: 0.85em;
            text-align: center;
        }

        #dialogBox {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.95), rgba(0,0,0,0.85));
            padding: 20px 30px;
            min-height: 200px;
        }

        #speakerName {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1em;
        }

        #speakerName.narrator { background: #6b8e23; }
        #speakerName.thought { background: #4682b4; font-style: italic; }

        #dialogText {
            color: white;
            font-size: 1.15em;
            line-height: 1.8;
            min-height: 80px;
        }

        #dialogText.thought {
            font-style: italic;
            color: #b0c4de;
        }

        #navButtons {
            position: absolute;
            bottom: 15px;
            right: 30px;
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .nav-btn.prev { background: #666; color: white; }
        .nav-btn.next { background: var(--accent-color); color: #333; }

        .nav-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #progressBar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: rgba(255,255,255,0.2);
        }

        #progressFill {
            height: 100%;
            background: var(--accent-color);
            transition: width 0.3s ease;
            width: 0%;
        }

        #sceneHeader {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 0.9em;
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        #controlPanel {
            position: fixed;
            top: 15px;
            left: 15px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .control-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .control-btn:hover { background: rgba(0,0,0,0.9); }

        /* çŸ¥è­˜è§£èª¬ãƒ‘ãƒãƒ« */
        #knowledgePanel {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .knowledge-content {
            background: white;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            border-radius: 20px;
            padding: 30px;
            overflow-y: auto;
        }

        .knowledge-content h3 {
            color: var(--primary-color);
            font-size: 1.4em;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--accent-color);
        }

        .knowledge-content .text {
            font-size: 1em;
            line-height: 1.8;
            white-space: pre-wrap;
            color: #333;
        }

        .knowledge-close {
            margin-top: 25px;
            padding: 12px 40px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
        }

        /* ã‚¯ã‚¤ã‚ºãƒ‘ãƒãƒ« */
        #quizPanel {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .quiz-content {
            background: white;
            max-width: 600px;
            width: 90%;
            border-radius: 20px;
            padding: 30px;
        }

        .quiz-content h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .quiz-question {
            font-size: 1.1em;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .quiz-option {
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            border-color: var(--accent-color);
            background: #f9fff9;
        }

        .quiz-option.selected {
            border-color: var(--primary-color);
            background: #e8f5e9;
        }

        .quiz-option.correct {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .quiz-option.wrong {
            border-color: #f44336;
            background: #ffebee;
        }

        .quiz-buttons {
            margin-top: 25px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .quiz-btn {
            padding: 12px 35px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
        }

        .quiz-btn.submit {
            background: var(--primary-color);
            color: white;
        }

        .quiz-btn.next {
            background: var(--accent-color);
            color: #333;
            display: none;
        }

        .quiz-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            display: none;
        }

        .quiz-result.correct {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .quiz-result.wrong {
            background: #ffebee;
            color: #c62828;
        }

        /* ã‚·ãƒ¼ãƒ³é¸æŠãƒ‘ãƒãƒ« */
        #sceneSelectPanel {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .scene-select-content {
            background: white;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            border-radius: 20px;
            padding: 30px;
            overflow-y: auto;
        }

        .scene-select-content h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .scene-select-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .scene-select-item {
            padding: 15px 20px;
            background: #f5f5f5;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.2s;
        }

        .scene-select-item:hover {
            background: #e8f5e9;
        }

        .scene-select-item.current {
            background: var(--accent-color);
        }

        .scene-select-item .num {
            background: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }

        .scene-select-close {
            margin-top: 20px;
            padding: 10px 30px;
            background: #666;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }

        /* ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */
        .error-message {
            color: #f44336;
            font-size: 0.9em;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ç”»é¢ -->
    <div id="loadScreen">
        <h1>ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒãƒ™ãƒ«æ•™æãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼</h1>
        <p>JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§æ•™æã‚’å†ç”Ÿã—ã¾ã™</p>

        <div class="load-box">
            <h2>ã‚·ãƒŠãƒªã‚ªJSONã‚’é¸æŠ</h2>
            <div class="file-input-wrapper">
                <label>scenario.json ã¾ãŸã¯ ã‚¨ãƒ‡ã‚£ã‚¿ã§ä½œæˆã—ãŸJSON</label>
                <input type="file" id="jsonFile" accept=".json">
            </div>
            <div id="loadError" class="error-message"></div>
            <button id="startBtn" disabled onclick="startViewer()">æ•™æã‚’é–‹å§‹</button>
        </div>

        <button class="demo-btn" onclick="loadDemo()">ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã§è©¦ã™</button>
    </div>

    <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
    <div id="titleScreen">
        <h1 id="gameTitle">æ•™æã‚¿ã‚¤ãƒˆãƒ«</h1>
        <h2 id="gameSubtitle">ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</h2>
        <div class="title-info" id="patientInfo"></div>
        <button id="playBtn" onclick="startGame()">ã¯ã˜ã‚ã‚‹</button>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="gameScreen">
        <div id="progressBar"><div id="progressFill"></div></div>
        <div id="backgroundLayer"></div>

        <div id="characterLayer">
            <div class="character-slot left" id="charLeft"></div>
            <div class="character-slot center" id="charCenter"></div>
            <div class="character-slot right" id="charRight"></div>
        </div>

        <div id="dialogBox">
            <span id="speakerName">ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</span>
            <div id="dialogText">ãƒ†ã‚­ã‚¹ãƒˆ</div>
            <div id="navButtons">
                <button class="nav-btn prev" id="prevBtn" onclick="prevCut()">â† æˆ»ã‚‹</button>
                <button class="nav-btn next" id="nextBtn" onclick="nextCut()">æ¬¡ã¸ â†’</button>
            </div>
        </div>

        <div id="sceneHeader">Scene 1</div>

        <div id="controlPanel">
            <button class="control-btn" onclick="showSceneSelect()">ã‚·ãƒ¼ãƒ³é¸æŠ</button>
            <button class="control-btn" onclick="backToTitle()">ã‚¿ã‚¤ãƒˆãƒ«ã¸</button>
        </div>
    </div>

    <!-- çŸ¥è­˜è§£èª¬ãƒ‘ãƒãƒ« -->
    <div id="knowledgePanel">
        <div class="knowledge-content">
            <h3 id="knowledgeTitle">çŸ¥è­˜è§£èª¬</h3>
            <div class="text" id="knowledgeText"></div>
            <button class="knowledge-close" onclick="closeKnowledge()">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- ã‚¯ã‚¤ã‚ºãƒ‘ãƒãƒ« -->
    <div id="quizPanel">
        <div class="quiz-content">
            <h3>ç¢ºèªã‚¯ã‚¤ã‚º</h3>
            <div class="quiz-question" id="quizQuestion"></div>
            <div class="quiz-options" id="quizOptions"></div>
            <div class="quiz-result" id="quizResult"></div>
            <div class="quiz-buttons">
                <button class="quiz-btn submit" id="quizSubmit" onclick="submitQuiz()">å›ç­”ã™ã‚‹</button>
                <button class="quiz-btn next" id="quizNext" onclick="closeQuiz()">æ¬¡ã¸é€²ã‚€</button>
            </div>
        </div>
    </div>

    <!-- ã‚·ãƒ¼ãƒ³é¸æŠãƒ‘ãƒãƒ« -->
    <div id="sceneSelectPanel">
        <div class="scene-select-content">
            <h3>ã‚·ãƒ¼ãƒ³é¸æŠ</h3>
            <div class="scene-select-list" id="sceneSelectList"></div>
            <button class="scene-select-close" onclick="closeSceneSelect()">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let scenarioData = null;
        let currentSceneIndex = 0;
        let currentCutIndex = 0;
        let selectedQuizOptions = [];

        // ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
        document.getElementById('jsonFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    const data = JSON.parse(ev.target.result);

                    // ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®åˆ¤å®šã¨å¤‰æ›
                    if (data.scenes) {
                        scenarioData = data;
                    } else if (data.meta && data.patient) {
                        // ã‚¨ãƒ‡ã‚£ã‚¿å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›
                        scenarioData = convertEditorData(data);
                    } else {
                        throw new Error('ä¸æ˜ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ã™');
                    }

                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('loadError').textContent = 'âœ“ èª­ã¿è¾¼ã¿æˆåŠŸ: ' + (scenarioData.scenes?.length || 0) + 'ã‚·ãƒ¼ãƒ³';
                    document.getElementById('loadError').style.color = '#4caf50';
                } catch (err) {
                    document.getElementById('loadError').textContent = 'ã‚¨ãƒ©ãƒ¼: ' + err.message;
                    document.getElementById('loadError').style.color = '#f44336';
                    document.getElementById('startBtn').disabled = true;
                }
            };
            reader.readAsText(file);
        });

        // ã‚¨ãƒ‡ã‚£ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›
        function convertEditorData(data) {
            return {
                title: data.meta?.title || 'ç„¡é¡Œ',
                subtitle: data.meta?.subtitle || '',
                meta: data.meta,
                patient: data.patient,
                characters: data.characters || [],
                scenes: data.scenes || [],
                speakerNames: buildSpeakerNames(data.characters || [])
            };
        }

        // è©±è€…åãƒãƒƒãƒ—ã‚’æ§‹ç¯‰
        function buildSpeakerNames(characters) {
            const names = {
                narration: 'ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
                thought: 'å¿ƒã®å£°'
            };
            characters.forEach(c => {
                names[c.id] = c.name;
            });
            return names;
        }

        // ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼é–‹å§‹
        function startViewer() {
            if (!scenarioData) return;

            document.getElementById('loadScreen').style.display = 'none';
            document.getElementById('titleScreen').style.display = 'flex';

            // ã‚¿ã‚¤ãƒˆãƒ«è¨­å®š
            document.getElementById('gameTitle').textContent = scenarioData.title || scenarioData.meta?.title || 'æ•™æ';
            document.getElementById('gameSubtitle').textContent = scenarioData.subtitle || scenarioData.meta?.subtitle || '';

            // æ‚£è€…æƒ…å ±
            const patient = scenarioData.patient;
            if (patient) {
                document.getElementById('patientInfo').innerHTML = `
                    <p><strong>æ‚£è€…å:</strong> ${patient.name || '---'}</p>
                    <p><strong>å¹´é½¢:</strong> ${patient.age || '---'}æ­³ / ${patient.gender || '---'}</p>
                    <p><strong>ç–¾æ‚£:</strong> ${patient.diagnosis || '---'}</p>
                    <p><strong>æ²»ç™‚:</strong> ${patient.treatment || '---'}</p>
                `;
            }

            // ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼é©ç”¨
            if (scenarioData.theme) {
                document.documentElement.style.setProperty('--primary-color', scenarioData.theme.primaryColor || '#2d5a27');
                document.documentElement.style.setProperty('--accent-color', scenarioData.theme.accentColor || '#8bc34a');
            }
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            document.getElementById('titleScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            currentSceneIndex = 0;
            currentCutIndex = 0;
            renderScene();
        }

        // ã‚·ãƒ¼ãƒ³æç”»
        function renderScene() {
            const scene = scenarioData.scenes[currentSceneIndex];
            if (!scene) return;

            const cut = scene.cuts[currentCutIndex];
            if (!cut) return;

            // èƒŒæ™¯
            const bgLayer = document.getElementById('backgroundLayer');
            const basePath = scenarioData.assetsPath || 'demo_assets';

            const bgImageMap = {
                'hospital_room': `${basePath}/backgrounds/bg_hospital_room.png`,
                'home_living': `${basePath}/backgrounds/bg_home_living.png`,
                'home_bedroom': `${basePath}/backgrounds/bg_home_bedroom.png`,
                'pharmacy': `${basePath}/backgrounds/bg_pharmacy.png`,
                'clinic': `${basePath}/backgrounds/bg_clinic.png`
            };

            const bgColorMap = {
                'hospital_room': 'linear-gradient(135deg, #4a6fa5, #2c3e50)',
                'home_living': 'linear-gradient(135deg, #8b7355, #5d4e37)',
                'home_bedroom': 'linear-gradient(135deg, #6b8e6b, #3d5c3d)',
                'pharmacy': 'linear-gradient(135deg, #5f9ea0, #2f4f4f)',
                'clinic': 'linear-gradient(135deg, #708090, #2f4f4f)'
            };

            if (scene.background && bgImageMap[scene.background]) {
                bgLayer.style.backgroundImage = `url('${bgImageMap[scene.background]}')`;
                bgLayer.style.backgroundSize = 'cover';
                bgLayer.style.backgroundPosition = 'center';
                bgLayer.style.backgroundColor = bgColorMap[scene.background] || '#2d2d44';
            } else {
                bgLayer.style.backgroundImage = 'none';
                bgLayer.style.background = 'linear-gradient(135deg, #2d5a27, #1e3a1a)';
            }

            // è©±è€…å
            const speakerEl = document.getElementById('speakerName');
            const speakerName = scenarioData.speakerNames?.[cut.speaker] || cut.speaker || 'ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³';
            speakerEl.textContent = speakerName;
            speakerEl.className = '';

            if (cut.speaker === 'narration' || cut.type === 'narration') {
                speakerEl.classList.add('narrator');
            } else if (cut.speaker === 'thought' || cut.type === 'thought') {
                speakerEl.classList.add('thought');
            }

            // ãƒ†ã‚­ã‚¹ãƒˆ
            const textEl = document.getElementById('dialogText');
            textEl.textContent = cut.text;
            textEl.className = '';
            if (cut.type === 'thought') {
                textEl.classList.add('thought');
            }

            // ã‚·ãƒ¼ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼
            document.getElementById('sceneHeader').textContent =
                `Scene ${scene.id}: ${scene.title} (${currentCutIndex + 1}/${scene.cuts.length})`;

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹
            const progress = ((currentCutIndex + 1) / scene.cuts.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            // ãƒŠãƒ“ãƒœã‚¿ãƒ³
            document.getElementById('prevBtn').disabled = (currentSceneIndex === 0 && currentCutIndex === 0);
            document.getElementById('nextBtn').textContent =
                currentCutIndex >= scene.cuts.length - 1 ? 'ã‚·ãƒ¼ãƒ³çµ‚äº†' : 'æ¬¡ã¸ â†’';

            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤º
            renderCharacters(cut, scene);
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æç”»
        function renderCharacters(cut, scene) {
            const leftSlot = document.getElementById('charLeft');
            const centerSlot = document.getElementById('charCenter');
            const rightSlot = document.getElementById('charRight');

            // ã‚¹ãƒ­ãƒƒãƒˆã‚’ã‚¯ãƒªã‚¢
            leftSlot.innerHTML = '';
            centerSlot.innerHTML = '';
            rightSlot.innerHTML = '';
            leftSlot.classList.add('hidden');
            centerSlot.classList.add('hidden');
            rightSlot.classList.add('hidden');

            // ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚„å¿ƒã®å£°ã®å ´åˆã¯ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼éè¡¨ç¤º
            if (cut.speaker === 'narration' || cut.type === 'narration') {
                return;
            }

            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æƒ…å ±ã‚’å–å¾—
            const characters = scenarioData.characters || [];
            const charInfo = getCharacterInfo(cut.speaker);

            // è¡¨æƒ…ã‚’å–å¾—
            const expression = cut.expression || 'neutral';
            const expressionLabel = getExpressionLabel(expression);

            // ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚’ä¸­å¤®ã«è¡¨ç¤º
            if (charInfo) {
                centerSlot.classList.remove('hidden');
                centerSlot.innerHTML = createCharacterElement(charInfo, expression, expressionLabel, true);
            }

            // ã‚µãƒ–ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆcutã«æŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
            if (cut.characters && Array.isArray(cut.characters)) {
                cut.characters.forEach((charId, index) => {
                    if (charId !== cut.speaker) {
                        const subChar = getCharacterInfo(charId);
                        if (subChar) {
                            const slot = index === 0 ? leftSlot : rightSlot;
                            slot.classList.remove('hidden');
                            slot.innerHTML = createCharacterElement(subChar, 'neutral', 'é€šå¸¸', false);
                        }
                    }
                });
            }
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æƒ…å ±ã‚’å–å¾—
        function getCharacterInfo(speakerId) {
            if (!speakerId || speakerId === 'narration' || speakerId === 'thought') return null;

            const characters = scenarioData.characters || [];
            const found = characters.find(c => c.id === speakerId);

            if (found) return found;

            // speakerNamesã‹ã‚‰åå‰ã‚’å–å¾—
            const name = scenarioData.speakerNames?.[speakerId];
            if (name) {
                return { id: speakerId, name: name };
            }

            return { id: speakerId, name: speakerId };
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¦ç´ ã‚’ç”Ÿæˆ
        function createCharacterElement(charInfo, expression, expressionLabel, isSpeaking) {
            // ç”»åƒãƒ‘ã‚¹ãŒã‚ã‚‹å ´åˆã¯å®Ÿéš›ã®ç”»åƒã‚’ä½¿ç”¨
            const imagePath = getCharacterImagePath(charInfo.id, expression);

            if (imagePath) {
                return `
                    <div class="character-image ${isSpeaking ? 'speaking' : ''}">
                        <img src="${imagePath}" alt="${charInfo.name}" onerror="this.parentElement.innerHTML=createPlaceholderHTML('${charInfo.id}', '${charInfo.name}', '${charInfo.role}', '${expressionLabel}', ${isSpeaking})">
                        <div class="char-label">${charInfo.name} - ${expressionLabel}</div>
                    </div>
                `;
            }

            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
            const emoji = getCharacterEmoji(charInfo.id, charInfo.role);
            const colorClass = getCharacterColor(charInfo.id);

            return `
                <div class="character-placeholder ${isSpeaking ? 'speaking' : ''}" style="--char-color: ${colorClass}">
                    <div class="avatar" style="background: ${colorClass}">${emoji}</div>
                    <div class="char-name">${charInfo.name}</div>
                    <div class="char-expression">${expressionLabel}</div>
                </div>
            `;
        }

        // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼HTMLç”Ÿæˆï¼ˆç”»åƒèª­ã¿è¾¼ã¿å¤±æ•—æ™‚ç”¨ï¼‰
        function createPlaceholderHTML(id, name, role, expressionLabel, isSpeaking) {
            const emoji = getCharacterEmoji(id, role);
            const colorClass = getCharacterColor(id);
            return `'<div class="character-placeholder ${isSpeaking ? 'speaking' : ''}" style="--char-color: ${colorClass}"><div class="avatar" style="background: ${colorClass}">${emoji}</div><div class="char-name">${name}</div><div class="char-expression">${expressionLabel}</div></div>'`;
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒãƒ‘ã‚¹ã‚’å–å¾—
        function getCharacterImagePath(charId, expression) {
            const basePath = scenarioData.assetsPath || 'demo_assets';

            // ä¸€èˆ¬è¡¨æƒ…ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆç•ªå·_åå‰ï¼‰
            const generalExpressionMap = {
                'smile': '01_smile',
                'worried': '02_worried',
                'surprised': '03_surprised',
                'thinking': '04_thinking',
                'neutral': '05_neutral',
                'relieved': '06_relieved',
                'serious': '07_serious',
                'determined': '07_serious',
                'confused': '08_confused',
                'grateful': '09_grateful',
                'tired': '06_relieved'
            };

            // kazuoå°‚ç”¨ã®åŒ»ç™‚è¡¨æƒ…ãƒãƒƒãƒ”ãƒ³ã‚°
            const kazuoMedicalMap = {
                'mild_distress': 'medical_01_breathless',
                'moderate_distress': 'medical_02_dyspnea',
                'severe_distress': 'medical_04_cyanosis',
                'coughing': 'medical_07_coughing',
                'using_oxygen': 'medical_03_pursed_lip',
                'resting': 'medical_05_neutral',
                'recovering': 'medical_09_recovering',
                'breathing_exercise': 'medical_03_pursed_lip',
                'post_exertion': 'medical_06_fatigue',
                'breathless': 'medical_01_breathless',
                'dyspnea': 'medical_02_dyspnea'
            };

            // kazuoã®å ´åˆ
            if (charId === 'kazuo') {
                // åŒ»ç™‚è¡¨æƒ…ã‚’ãƒã‚§ãƒƒã‚¯
                if (kazuoMedicalMap[expression]) {
                    return `${basePath}/characters/kazuo_expressions/kazuo_${kazuoMedicalMap[expression]}.png`;
                }
                // ä¸€èˆ¬è¡¨æƒ…
                const expFile = generalExpressionMap[expression] || '05_neutral';
                return `${basePath}/characters/kazuo_expressions/kazuo_general_${expFile}.png`;
            }

            // ãã®ä»–ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆichiko, doctor, yamada, etc.ï¼‰
            const expFile = generalExpressionMap[expression] || '05_neutral';
            return `${basePath}/characters/${charId}_expressions/${charId}_${expFile}.png`;
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®çµµæ–‡å­—ã‚’å–å¾—
        function getCharacterEmoji(id, role) {
            const emojiMap = {
                'kazuo': 'ğŸ‘´',
                'ichiko': 'ğŸ‘µ',
                'yamada': 'ğŸ‘©â€âš•ï¸',
                'doctor': 'ğŸ‘¨â€âš•ï¸',
                'pharmacist': 'ğŸ’Š',
                'sato': 'ğŸ“‹',
                'patient': 'ğŸ¤’',
                'nurse': 'ğŸ‘©â€âš•ï¸',
                'wife': 'ğŸ‘µ',
                'careManager': 'ğŸ“‹'
            };
            return emojiMap[id] || emojiMap[role] || 'ğŸ‘¤';
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è‰²ã‚’å–å¾—
        function getCharacterColor(id) {
            const colorMap = {
                'kazuo': 'linear-gradient(135deg, #3498db, #2980b9)',
                'ichiko': 'linear-gradient(135deg, #e91e63, #c2185b)',
                'yamada': 'linear-gradient(135deg, #4caf50, #388e3c)',
                'doctor': 'linear-gradient(135deg, #9c27b0, #7b1fa2)',
                'pharmacist': 'linear-gradient(135deg, #00bcd4, #0097a7)',
                'sato': 'linear-gradient(135deg, #ff9800, #f57c00)'
            };
            return colorMap[id] || 'linear-gradient(135deg, #607d8b, #455a64)';
        }

        // è¡¨æƒ…ãƒ©ãƒ™ãƒ«ã‚’å–å¾—
        function getExpressionLabel(expression) {
            const labelMap = {
                'neutral': 'é€šå¸¸',
                'smile': 'ç¬‘é¡”',
                'thinking': 'è€ƒãˆä¸­',
                'worried': 'å¿ƒé…',
                'tired': 'ç–²ã‚Œ',
                'surprised': 'é©šã',
                'relieved': 'å®‰å¿ƒ',
                'grateful': 'æ„Ÿè¬',
                'determined': 'æ±ºæ„',
                'mild_distress': 'è»½åº¦ã®è‹¦ã—ã•',
                'moderate_distress': 'ä¸­ç¨‹åº¦ã®è‹¦ã—ã•',
                'severe_distress': 'é‡åº¦ã®è‹¦ã—ã•',
                'coughing': 'å’³ãè¾¼ã¿',
                'using_oxygen': 'é…¸ç´ å¸å…¥ä¸­',
                'resting': 'ä¼‘æ¯ä¸­',
                'recovering': 'å›å¾©ä¸­',
                'breathing_exercise': 'å‘¼å¸ç·´ç¿’',
                'post_exertion': 'åŠ´ä½œå¾Œ'
            };
            return labelMap[expression] || expression;
        }

        // å‰ã®ã‚«ãƒƒãƒˆ
        function prevCut() {
            if (currentCutIndex > 0) {
                currentCutIndex--;
                renderScene();
            } else if (currentSceneIndex > 0) {
                currentSceneIndex--;
                const prevScene = scenarioData.scenes[currentSceneIndex];
                currentCutIndex = prevScene.cuts.length - 1;
                renderScene();
            }
        }

        // æ¬¡ã®ã‚«ãƒƒãƒˆ
        function nextCut() {
            const scene = scenarioData.scenes[currentSceneIndex];

            if (currentCutIndex < scene.cuts.length - 1) {
                currentCutIndex++;
                renderScene();
            } else {
                // ã‚·ãƒ¼ãƒ³çµ‚äº†
                endScene();
            }
        }

        // ã‚·ãƒ¼ãƒ³çµ‚äº†
        function endScene() {
            const scene = scenarioData.scenes[currentSceneIndex];

            // çŸ¥è­˜è§£èª¬
            if (scene.knowledge && scene.knowledge.title) {
                showKnowledge(scene.knowledge);
            } else if (scene.quiz && scene.quiz.question) {
                showQuiz(scene.quiz);
            } else {
                goToNextScene();
            }
        }

        // çŸ¥è­˜è§£èª¬è¡¨ç¤º
        function showKnowledge(knowledge) {
            document.getElementById('knowledgeTitle').textContent = knowledge.title;
            document.getElementById('knowledgeText').textContent = knowledge.text;
            document.getElementById('knowledgePanel').style.display = 'flex';
        }

        // çŸ¥è­˜è§£èª¬é–‰ã˜ã‚‹
        function closeKnowledge() {
            document.getElementById('knowledgePanel').style.display = 'none';

            const scene = scenarioData.scenes[currentSceneIndex];
            if (scene.quiz && scene.quiz.question) {
                showQuiz(scene.quiz);
            } else {
                goToNextScene();
            }
        }

        // ã‚¯ã‚¤ã‚ºè¡¨ç¤º
        function showQuiz(quiz) {
            document.getElementById('quizQuestion').textContent = quiz.question;

            const optionsEl = document.getElementById('quizOptions');
            optionsEl.innerHTML = quiz.options.map((opt, i) => `
                <div class="quiz-option" data-index="${i}" onclick="selectQuizOption(${i})">
                    ${opt.text}
                </div>
            `).join('');

            selectedQuizOptions = [];
            document.getElementById('quizResult').style.display = 'none';
            document.getElementById('quizSubmit').style.display = 'inline-block';
            document.getElementById('quizNext').style.display = 'none';
            document.getElementById('quizPanel').style.display = 'flex';
        }

        // ã‚¯ã‚¤ã‚ºé¸æŠ
        function selectQuizOption(index) {
            const options = document.querySelectorAll('.quiz-option');
            const scene = scenarioData.scenes[currentSceneIndex];
            const isMultiple = scene.quiz?.multipleAnswer;

            if (isMultiple) {
                options[index].classList.toggle('selected');
                if (selectedQuizOptions.includes(index)) {
                    selectedQuizOptions = selectedQuizOptions.filter(i => i !== index);
                } else {
                    selectedQuizOptions.push(index);
                }
            } else {
                options.forEach(opt => opt.classList.remove('selected'));
                options[index].classList.add('selected');
                selectedQuizOptions = [index];
            }
        }

        // ã‚¯ã‚¤ã‚ºå›ç­”
        function submitQuiz() {
            const scene = scenarioData.scenes[currentSceneIndex];
            const quiz = scene.quiz;
            const options = document.querySelectorAll('.quiz-option');

            let isCorrect = true;
            quiz.options.forEach((opt, i) => {
                const selected = selectedQuizOptions.includes(i);
                if (opt.correct) {
                    options[i].classList.add('correct');
                    if (!selected) isCorrect = false;
                } else if (selected) {
                    options[i].classList.add('wrong');
                    isCorrect = false;
                }
            });

            const resultEl = document.getElementById('quizResult');
            resultEl.textContent = isCorrect ? 'æ­£è§£ã§ã™ï¼' : 'ä¸æ­£è§£ã§ã™';
            resultEl.className = 'quiz-result ' + (isCorrect ? 'correct' : 'wrong');
            resultEl.style.display = 'block';

            document.getElementById('quizSubmit').style.display = 'none';
            document.getElementById('quizNext').style.display = 'inline-block';
        }

        // ã‚¯ã‚¤ã‚ºé–‰ã˜ã‚‹
        function closeQuiz() {
            document.getElementById('quizPanel').style.display = 'none';
            goToNextScene();
        }

        // æ¬¡ã®ã‚·ãƒ¼ãƒ³ã¸
        function goToNextScene() {
            if (currentSceneIndex < scenarioData.scenes.length - 1) {
                currentSceneIndex++;
                currentCutIndex = 0;
                renderScene();
            } else {
                // çµ‚äº†
                alert('ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼æ•™æãŒçµ‚äº†ã—ã¾ã—ãŸã€‚');
                backToTitle();
            }
        }

        // ã‚·ãƒ¼ãƒ³é¸æŠ
        function showSceneSelect() {
            const listEl = document.getElementById('sceneSelectList');
            listEl.innerHTML = scenarioData.scenes.map((scene, i) => `
                <div class="scene-select-item ${i === currentSceneIndex ? 'current' : ''}" onclick="goToScene(${i})">
                    <span class="num">${scene.id}</span>
                    <span>${scene.title}</span>
                </div>
            `).join('');
            document.getElementById('sceneSelectPanel').style.display = 'flex';
        }

        function closeSceneSelect() {
            document.getElementById('sceneSelectPanel').style.display = 'none';
        }

        function goToScene(index) {
            currentSceneIndex = index;
            currentCutIndex = 0;
            closeSceneSelect();
            renderScene();
        }

        // ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹
        function backToTitle() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('titleScreen').style.display = 'flex';
        }

        // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿
        function loadDemo() {
            scenarioData = {
                title: "åœ¨å®…ç™‚é¤Šã‚’æ”¯ãˆã‚‹è¨ªå•çœ‹è­·",
                subtitle: "COPDäº‹ä¾‹ - ãƒ‡ãƒ¢ç‰ˆ",
                assetsPath: "demo_assets",
                meta: { title: "åœ¨å®…ç™‚é¤Šã‚’æ”¯ãˆã‚‹è¨ªå•çœ‹è­·", subtitle: "COPDäº‹ä¾‹" },
                patient: {
                    name: "è–éš·ä¸€ç”·",
                    age: 78,
                    gender: "ç”·æ€§",
                    diagnosis: "COPDï¼ˆæ…¢æ€§é–‰å¡æ€§è‚ºç–¾æ‚£ï¼‰",
                    treatment: "åœ¨å®…é…¸ç´ ç™‚æ³•ï¼ˆå®‰é™æ™‚2Lã€åŠ´ä½œæ™‚4Lï¼‰"
                },
                theme: { primaryColor: "#2d5a27", accentColor: "#8bc34a" },
                speakerNames: {
                    narration: "ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",
                    thought: "å¿ƒã®å£°",
                    kazuo: "è–éš·ä¸€ç”·",
                    ichiko: "è–éš·å¸‚å­",
                    doctor: "ä¸»æ²»åŒ»",
                    yamada: "å±±ç”°çœ‹è­·å¸«",
                    pharmacist: "è–¬å‰¤å¸«",
                    sato: "ä½è—¤ã‚±ã‚¢ãƒãƒ"
                },
                characters: [
                    { id: "kazuo", name: "è–éš·ä¸€ç”·", role: "patient" },
                    { id: "ichiko", name: "è–éš·å¸‚å­", role: "wife" },
                    { id: "yamada", name: "å±±ç”°çœ‹è­·å¸«", role: "nurse" },
                    { id: "doctor", name: "ä¸»æ²»åŒ»", role: "doctor" },
                    { id: "pharmacist", name: "è–¬å‰¤å¸«", role: "pharmacist" },
                    { id: "sato", name: "ä½è—¤ã‚±ã‚¢ãƒãƒ", role: "careManager" }
                ],
                scenes: [
                    {
                        id: 1,
                        title: "ã‚¤ãƒ³ãƒˆãƒ­",
                        background: "",
                        cuts: [
                            { id: "s01_01", speaker: "narration", text: "ä»Šå›ã®ä¸»äººå…¬ã¯è–éš·ä¸€ç”·ã•ã‚“ã€78æ­³ã®ç”·æ€§ã§ã™ã€‚" },
                            { id: "s01_02", speaker: "narration", text: "3å¹´å‰ã«COPDã¨è¨ºæ–­ã•ã‚Œã€åœ¨å®…é…¸ç´ ç™‚æ³•ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚" },
                            { id: "s01_03", speaker: "narration", text: "ä¸€ç”·ã•ã‚“ã®è¦–ç‚¹ã§ã€è¨ªå•çœ‹è­·ã‚’ä½“é¨“ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚" }
                        ],
                        knowledge: {
                            title: "COPDã¨ã¯",
                            text: "COPDï¼ˆæ…¢æ€§é–‰å¡æ€§è‚ºç–¾æ‚£ï¼‰ã¯ã€ã‚¿ãƒã‚³ç…™ãªã©ã®æœ‰å®³ç‰©è³ªã‚’é•·æœŸã«å¸å…¥ã™ã‚‹ã“ã¨ã§ç”Ÿã˜ã‚‹è‚ºã®ç‚ç—‡æ€§ç–¾æ‚£ã§ã™ã€‚\n\nã€ä¸»ãªç—‡çŠ¶ã€‘\nãƒ»æ¯åˆ‡ã‚Œ\nãƒ»æ…¢æ€§çš„ãªå’³ãƒ»ç—°\n\nã€å±é™ºå› å­ã€‘\nãƒ»å–«ç…™ãŒæœ€å¤§ã®å±é™ºå› å­"
                        }
                    },
                    {
                        id: 2,
                        title: "é€€é™¢å‰ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹",
                        background: "hospital_room",
                        cuts: [
                            { id: "s02_01", speaker: "doctor", expression: "neutral", text: "è–éš·ã•ã‚“ã€å…¥é™¢ä¸­ã®æ²»ç™‚ã§ç—‡çŠ¶ã¯æ”¹å–„ã—ã¾ã—ãŸã€‚" },
                            { id: "s02_02", speaker: "kazuo", type: "thought", expression: "worried", text: "ï¼ˆå¿ƒã®å£°ï¼‰ã‚„ã£ã±ã‚Šæ‚ªããªã£ã¦ã„ã‚‹ã®ã‹...ã§ã‚‚å®¶ã«å¸°ã‚ŠãŸã„ã€‚" },
                            { id: "s02_03", speaker: "doctor", expression: "thinking", text: "NPPVã‚’è‡ªå®…ã§ã‚‚ç¶šã‘ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ãŒã€ã„ã‹ãŒã§ã™ã‹ï¼Ÿ" },
                            { id: "s02_04", speaker: "kazuo", expression: "worried", text: "å…ˆç”Ÿã€ã‚ã®æ©Ÿæ¢°ã¯çœ ã‚Œãªã„ã—...é…¸ç´ ã ã‘ã§ãªã‚“ã¨ã‹ãªã‚Šã¾ã›ã‚“ã‹ï¼Ÿ" },
                            { id: "s02_05", speaker: "doctor", expression: "serious", text: "ãã†ã§ã™ã‹...ã§ã¯ã€è¨ªå•çœ‹è­·ã‚’åˆ©ç”¨ã—ãªãŒã‚‰æ§˜å­ã‚’è¦‹ã¾ã—ã‚‡ã†ã€‚" },
                            { id: "s02_06", speaker: "kazuo", expression: "relieved", text: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚å®¶ã«å¸°ã‚Œã‚‹ã‚“ã§ã™ã­ã€‚" }
                        ],
                        knowledge: {
                            title: "NPPVã¨ã¯",
                            text: "NPPVï¼ˆéä¾µè¥²çš„é™½åœ§æ›æ°—ç™‚æ³•ï¼‰ã¯ã€ãƒã‚¹ã‚¯ã‚’ä»‹ã—ã¦å‘¼å¸ã‚’è£œåŠ©ã™ã‚‹æ²»ç™‚æ³•ã§ã™ã€‚\n\nãƒ»æ°—ç®¡æŒ¿ç®¡ãŒä¸è¦\nãƒ»COPDæ€¥æ€§å¢—æ‚ªæ™‚ã®ç¬¬ä¸€é¸æŠ\nãƒ»ãƒã‚¹ã‚¯ã®ä¸å¿«æ„Ÿã‹ã‚‰ç¶™ç¶šãŒé›£ã—ã„æ‚£è€…ã‚‚"
                        },
                        quiz: {
                            question: "COPDæ€¥æ€§å¢—æ‚ªæ™‚ã«æœ€åˆã«é¸æŠã•ã‚Œã‚‹æ²»ç™‚ã¯ï¼Ÿ",
                            options: [
                                { text: "æ°—ç®¡æŒ¿ç®¡", correct: false },
                                { text: "NPPVï¼ˆéä¾µè¥²çš„é™½åœ§æ›æ°—ç™‚æ³•ï¼‰", correct: true },
                                { text: "é«˜æµé‡é…¸ç´ ", correct: false },
                                { text: "ãƒãƒ–ãƒ©ã‚¤ã‚¶ãƒ¼", correct: false }
                            ]
                        }
                    },
                    {
                        id: 3,
                        title: "é€€é™¢å¾Œã®æ—¥å¸¸",
                        background: "home_living",
                        cuts: [
                            { id: "s03_01", speaker: "kazuo", expression: "relieved", text: "ã‚„ã£ã±ã‚Šå®¶ãŒä¸€ç•ªè½ã¡ç€ããªã€‚" },
                            { id: "s03_02", speaker: "ichiko", expression: "smile", text: "ãŠçˆ¶ã•ã‚“ã€ç„¡ç†ã—ãªã„ã§ã­ã€‚é…¸ç´ ã¡ã‚ƒã‚“ã¨ã¤ã‘ã¦ã‚‹ï¼Ÿ" },
                            { id: "s03_03", speaker: "kazuo", expression: "smile", text: "ã‚ã‚ã€å¤§ä¸ˆå¤«ã ã‚ˆã€‚å¿ƒé…ã—ã™ãã ã€‚" },
                            { id: "s03_04", speaker: "kazuo", type: "thought", expression: "thinking", text: "ï¼ˆå¿ƒã®å£°ï¼‰ã§ã‚‚ã€æœ¬å½“ã«ã“ã®ã¾ã¾å¤§ä¸ˆå¤«ãªã®ã‹ãª..." },
                            { id: "s03_05", speaker: "ichiko", expression: "thinking", text: "æ˜æ—¥ã‹ã‚‰è¨ªå•çœ‹è­·å¸«ã•ã‚“ãŒæ¥ã¦ãã‚Œã‚‹ã£ã¦ã€‚" },
                            { id: "s03_06", speaker: "kazuo", expression: "neutral", text: "ãã†ã‹...ã©ã‚“ãªäººã ã‚ã†ãªã€‚" }
                        ],
                        knowledge: {
                            title: "åœ¨å®…é…¸ç´ ç™‚æ³•ï¼ˆHOTï¼‰",
                            text: "åœ¨å®…é…¸ç´ ç™‚æ³•ã¯ã€è‡ªå®…ã§é…¸ç´ å¸å…¥ã‚’è¡Œã†æ²»ç™‚æ³•ã§ã™ã€‚\n\nã€é©å¿œã€‘\nãƒ»æ…¢æ€§å‘¼å¸ä¸å…¨ï¼ˆPaO2 55mmHgä»¥ä¸‹ï¼‰\nãƒ»è‚ºé«˜è¡€åœ§ã‚’ä¼´ã†å ´åˆ\n\nã€æ³¨æ„ç‚¹ã€‘\nãƒ»ç«æ°—å³ç¦\nãƒ»æµé‡ã¯åŒ»å¸«ã®æŒ‡ç¤ºé€šã‚Šã«\nãƒ»åŠ´ä½œæ™‚ã¯æµé‡ã‚’ä¸Šã’ã‚‹"
                        }
                    },
                    {
                        id: 4,
                        title: "åˆå›è¨ªå•çœ‹è­·",
                        background: "home_bedroom",
                        cuts: [
                            { id: "s04_01", speaker: "yamada", expression: "smile", text: "è–éš·ã•ã‚“ã€ã¯ã˜ã‚ã¾ã—ã¦ã€‚è¨ªå•çœ‹è­·å¸«ã®å±±ç”°ã§ã™ã€‚" },
                            { id: "s04_02", speaker: "kazuo", expression: "neutral", text: "ã‚ã‚ã€ã©ã†ã‚‚ã€‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚" },
                            { id: "s04_03", speaker: "yamada", expression: "neutral", text: "ä»Šæ—¥ã¯ãŠä½“ã®çŠ¶æ…‹ã‚’ç¢ºèªã•ã›ã¦ãã ã•ã„ã­ã€‚æ¯è‹¦ã—ã•ã¯ã„ã‹ãŒã§ã™ã‹ï¼Ÿ" },
                            { id: "s04_04", speaker: "kazuo", expression: "thinking", text: "ã†ãƒ¼ã‚“ã€å‹•ãã¨å°‘ã—æ¯ãŒä¸ŠãŒã‚‹ã‘ã©ã€ã¾ã‚å¤§ä¸ˆå¤«ã‹ãªã€‚" },
                            { id: "s04_05", speaker: "yamada", expression: "thinking", text: "ãã†ã§ã™ã‹ã€‚SpO2ã‚’æ¸¬ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚" },
                            { id: "s04_06", speaker: "yamada", expression: "neutral", text: "å®‰é™æ™‚ã§94%ã§ã™ã­ã€‚æ­©ã„ãŸå¾Œã‚‚æ¸¬ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚" },
                            { id: "s04_07", speaker: "kazuo", expression: "mild_distress", text: "ã¯ã...ã¯ã...å°‘ã—æ­©ã„ãŸã ã‘ã§..." }
                        ],
                        knowledge: {
                            title: "SpO2ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°",
                            text: "SpO2ï¼ˆçµŒçš®çš„å‹•è„ˆè¡€é…¸ç´ é£½å’Œåº¦ï¼‰ã¯å‘¼å¸çŠ¶æ…‹ã®é‡è¦ãªæŒ‡æ¨™ã§ã™ã€‚\n\nã€åŸºæº–å€¤ã€‘\nãƒ»æ­£å¸¸ï¼š96-100%\nãƒ»COPDæ‚£è€…ï¼š90%ä»¥ä¸Šã‚’ç¶­æŒ\n\nã€åŠ´ä½œæ™‚ã®è©•ä¾¡ã€‘\nãƒ»6åˆ†é–“æ­©è¡Œãƒ†ã‚¹ãƒˆ\nãƒ»æ—¥å¸¸ç”Ÿæ´»å‹•ä½œã§ã®å¤‰åŒ–"
                        },
                        quiz: {
                            question: "COPDæ‚£è€…ã®SpO2ç®¡ç†ç›®æ¨™ã¨ã—ã¦é©åˆ‡ãªã®ã¯ï¼Ÿ",
                            options: [
                                { text: "å¸¸ã«100%ã‚’ç¶­æŒã™ã‚‹", correct: false },
                                { text: "90%ä»¥ä¸Šã‚’ç¶­æŒã™ã‚‹", correct: true },
                                { text: "85%ä»¥ä¸Šã§ã‚ã‚Œã°å•é¡Œãªã„", correct: false },
                                { text: "SpO2ã¯é‡è¦ã§ã¯ãªã„", correct: false }
                            ]
                        }
                    },
                    {
                        id: 5,
                        title: "å‘¼å¸ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³",
                        background: "home_bedroom",
                        cuts: [
                            { id: "s05_01", speaker: "yamada", expression: "smile", text: "ä»Šæ—¥ã¯å‘¼å¸æ³•ã®ç·´ç¿’ã‚’ã—ã¾ã—ã‚‡ã†ã€‚" },
                            { id: "s05_02", speaker: "kazuo", expression: "thinking", text: "å‘¼å¸æ³•ï¼Ÿãã‚“ãªã“ã¨ã§æ¥½ã«ãªã‚‹ã®ã‹ãª..." },
                            { id: "s05_03", speaker: "yamada", expression: "neutral", text: "å£ã™ã¼ã‚å‘¼å¸ã¨ã„ã£ã¦ã€ã‚†ã£ãã‚Šåãã“ã¨ã§æ¯è‹¦ã—ã•ãŒå’Œã‚‰ãã¾ã™ã€‚" },
                            { id: "s05_04", speaker: "yamada", expression: "smile", text: "é¼»ã‹ã‚‰å¸ã£ã¦...å£ã‚’ã™ã¼ã‚ã¦ã‚†ã£ãã‚Šåã„ã¦..." },
                            { id: "s05_05", speaker: "kazuo", expression: "breathing_exercise", text: "ãµã…ãƒ¼...ãªã‚‹ã»ã©ã€å°‘ã—æ¥½ã‹ã‚‚ã€‚" },
                            { id: "s05_06", speaker: "yamada", expression: "smile", text: "ã„ã„ã§ã™ã­ï¼æ¯æ—¥ç·´ç¿’ã—ã¦ã¿ã¦ãã ã•ã„ã€‚" },
                            { id: "s05_07", speaker: "kazuo", expression: "grateful", text: "ã‚ã‚ŠãŒã¨ã†ã€‚ã‚„ã£ã¦ã¿ã‚‹ã‚ˆã€‚" }
                        ],
                        knowledge: {
                            title: "å£ã™ã¼ã‚å‘¼å¸",
                            text: "å£ã™ã¼ã‚å‘¼å¸ã¯COPDæ‚£è€…ã®å‘¼å¸å›°é›£ã‚’è»½æ¸›ã™ã‚‹åŠ¹æœçš„ãªæŠ€æ³•ã§ã™ã€‚\n\nã€æ–¹æ³•ã€‘\n1. é¼»ã‹ã‚‰2ç§’ã‹ã‘ã¦å¸ã†\n2. å£ã‚’ã™ã¼ã‚ã¦4ç§’ã‹ã‘ã¦åã\n\nã€åŠ¹æœã€‘\nãƒ»æ°—é“å†…åœ§ã®ä¸Šæ˜‡\nãƒ»æœ«æ¢¢æ°—é“ã®è™šè„±é˜²æ­¢\nãƒ»å‘¼å¸åŠ¹ç‡ã®æ”¹å–„"
                        }
                    }
                ]
            };

            document.getElementById('loadError').textContent = 'âœ“ ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ';
            document.getElementById('loadError').style.color = '#4caf50';
            document.getElementById('startBtn').disabled = false;
        }
    </script>
</body>
</html>

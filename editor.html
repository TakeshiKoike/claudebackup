<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒãƒ™ãƒ«æ•™æã‚¨ãƒ‡ã‚£ã‚¿</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #2d5a27;
            --secondary: #4a7c43;
            --accent: #8bc34a;
            --bg: #f5f5f5;
            --card: #ffffff;
            --text: #333;
            --border: #ddd;
        }

        body {
            font-family: 'Hiragino Sans', 'Noto Sans JP', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header {
            background: var(--primary);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        header h1 {
            font-size: 1.3em;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .header-btn.primary {
            background: white;
            color: var(--primary);
        }

        .header-btn.secondary {
            background: var(--accent);
            color: var(--text);
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .container {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar {
            width: 280px;
            background: var(--card);
            border-right: 1px solid var(--border);
            overflow-y: auto;
        }

        .sidebar-section {
            border-bottom: 1px solid var(--border);
        }

        .sidebar-header {
            padding: 15px;
            background: #f9f9f9;
            font-weight: bold;
            font-size: 0.9em;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header:hover {
            background: #f0f0f0;
        }

        .sidebar-content {
            padding: 10px;
        }

        .scene-list {
            list-style: none;
        }

        .scene-item {
            padding: 10px 15px;
            margin: 5px 0;
            background: #f9f9f9;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .scene-item:hover {
            background: #e8f5e9;
        }

        .scene-item.active {
            background: var(--accent);
            color: var(--text);
        }

        .scene-item .scene-num {
            background: var(--primary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            margin-right: 10px;
        }

        .scene-item.active .scene-num {
            background: white;
            color: var(--primary);
        }

        .add-btn {
            width: 100%;
            padding: 10px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }

        .add-btn:hover {
            background: var(--primary);
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
        .main {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card h2 {
            font-size: 1.1em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #666;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(139, 195, 74, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        /* ã‚«ãƒƒãƒˆãƒªã‚¹ãƒˆ */
        .cut-list {
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .cut-item {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s;
        }

        .cut-item:last-child {
            border-bottom: none;
        }

        .cut-item:hover {
            background: #f9f9f9;
        }

        .cut-item.active {
            background: #e8f5e9;
        }

        .cut-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .cut-id {
            font-size: 0.8em;
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .cut-speaker {
            font-size: 0.85em;
            color: #666;
        }

        .cut-text {
            font-size: 0.95em;
            color: #333;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .cut-actions {
            display: flex;
            gap: 5px;
        }

        .cut-actions button {
            padding: 3px 8px;
            font-size: 0.75em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .cut-actions .edit-btn {
            background: #2196f3;
            color: white;
        }

        .cut-actions .delete-btn {
            background: #f44336;
            color: white;
        }

        /* ã‚¿ãƒ– */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border);
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }

        .tab:hover {
            background: #f9f9f9;
        }

        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ã‚¯ã‚¤ã‚º */
        .quiz-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .quiz-option input[type="text"] {
            flex: 1;
        }

        .quiz-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 25px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h3 {
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: #ddd;
            color: #333;
        }

        .btn:hover {
            opacity: 0.9;
        }

        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .preview-container {
            background: #1a1a2e;
            border-radius: 12px;
            aspect-ratio: 16/9;
            position: relative;
            overflow: hidden;
        }

        .preview-bg {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-color: #2d2d44;
        }

        .preview-dialog {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.95), rgba(0,0,0,0.8));
            padding: 15px 20px;
            color: white;
        }

        .preview-speaker {
            display: inline-block;
            background: var(--primary);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .preview-text {
            font-size: 1em;
            line-height: 1.6;
        }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç®¡ç† */
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .character-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .character-avatar {
            width: 80px;
            height: 80px;
            background: var(--secondary);
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
        }

        .character-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .character-role {
            font-size: 0.85em;
            color: #666;
        }

        /* JSONå‡ºåŠ› */
        .json-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85em;
            max-height: 400px;
            overflow: auto;
            white-space: pre-wrap;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                max-height: 200px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>ğŸ“š ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒãƒ™ãƒ«æ•™æã‚¨ãƒ‡ã‚£ã‚¿</h1>
        <div class="header-buttons">
            <button class="header-btn secondary" onclick="loadSample()">ã‚µãƒ³ãƒ—ãƒ«èª­è¾¼</button>
            <button class="header-btn secondary" onclick="importJSON()">JSONã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
            <button class="header-btn primary" onclick="exportJSON()">JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        </div>
    </header>

    <div class="container">
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <div class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-header" onclick="toggleSection(this)">
                    ğŸ“– ã‚·ãƒ¼ãƒ³ä¸€è¦§
                    <span>â–¼</span>
                </div>
                <div class="sidebar-content">
                    <ul class="scene-list" id="sceneList"></ul>
                    <button class="add-btn" onclick="addScene()">+ ã‚·ãƒ¼ãƒ³ã‚’è¿½åŠ </button>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-header" onclick="toggleSection(this)">
                    ğŸ‘¤ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼
                    <span>â–¼</span>
                </div>
                <div class="sidebar-content">
                    <ul class="scene-list" id="characterList"></ul>
                    <button class="add-btn" onclick="openCharacterModal()">+ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’è¿½åŠ </button>
                </div>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ -->
        <div class="main">
            <!-- ã‚¿ãƒ– -->
            <div class="tabs">
                <div class="tab active" onclick="switchTab('project')">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š</div>
                <div class="tab" onclick="switchTab('scene')">ã‚·ãƒ¼ãƒ³ç·¨é›†</div>
                <div class="tab" onclick="switchTab('preview')">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
            </div>

            <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šã‚¿ãƒ– -->
            <div id="projectTab" class="tab-content active">
                <div class="card">
                    <h2>åŸºæœ¬æƒ…å ±</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>æ•™æã‚¿ã‚¤ãƒˆãƒ«</label>
                            <input type="text" id="projectTitle" placeholder="ä¾‹ï¼šåœ¨å®…ç™‚é¤Šã‚’æ”¯ãˆã‚‹è¨ªå•çœ‹è­·">
                        </div>
                        <div class="form-group">
                            <label>ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</label>
                            <input type="text" id="projectSubtitle" placeholder="ä¾‹ï¼šCOPDäº‹ä¾‹">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>å¯¾è±¡è€…</label>
                            <input type="text" id="projectAudience" placeholder="ä¾‹ï¼šçœ‹è­·å­¦ç”Ÿãƒ»è¨ªå•çœ‹è­·å¸«">
                        </div>
                        <div class="form-group">
                            <label>ä½œæˆè€…</label>
                            <input type="text" id="projectAuthor" placeholder="ä¾‹ï¼šè–éš·ã‚¯ãƒªã‚¹ãƒˆãƒ•ã‚¡ãƒ¼å¤§å­¦">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>æ‚£è€…æƒ…å ±</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>æ‚£è€…å</label>
                            <input type="text" id="patientName" placeholder="ä¾‹ï¼šè–éš·ä¸€ç”·">
                        </div>
                        <div class="form-group">
                            <label>å¹´é½¢</label>
                            <input type="number" id="patientAge" placeholder="ä¾‹ï¼š78">
                        </div>
                        <div class="form-group">
                            <label>æ€§åˆ¥</label>
                            <select id="patientGender">
                                <option value="ç”·æ€§">ç”·æ€§</option>
                                <option value="å¥³æ€§">å¥³æ€§</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ç–¾æ‚£ãƒ»è¨ºæ–­å</label>
                        <input type="text" id="patientDiagnosis" placeholder="ä¾‹ï¼šCOPDï¼ˆæ…¢æ€§é–‰å¡æ€§è‚ºç–¾æ‚£ï¼‰">
                    </div>
                    <div class="form-group">
                        <label>æ²»ç™‚å†…å®¹</label>
                        <input type="text" id="patientTreatment" placeholder="ä¾‹ï¼šåœ¨å®…é…¸ç´ ç™‚æ³•ï¼ˆå®‰é™æ™‚2Lã€åŠ´ä½œæ™‚4Lï¼‰">
                    </div>
                </div>

                <div class="card">
                    <h2>ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼</label>
                            <input type="color" id="primaryColor" value="#2d5a27">
                        </div>
                        <div class="form-group">
                            <label>ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼</label>
                            <input type="color" id="accentColor" value="#8bc34a">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ã‚·ãƒ¼ãƒ³ç·¨é›†ã‚¿ãƒ– -->
            <div id="sceneTab" class="tab-content">
                <div class="card">
                    <h2>ã‚·ãƒ¼ãƒ³æƒ…å ±</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ã‚·ãƒ¼ãƒ³ã‚¿ã‚¤ãƒˆãƒ«</label>
                            <input type="text" id="sceneTitle" placeholder="ä¾‹ï¼šé€€é™¢å‰ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹">
                        </div>
                        <div class="form-group">
                            <label>èƒŒæ™¯</label>
                            <select id="sceneBackground">
                                <option value="">ãªã—</option>
                                <option value="hospital_room">ç—…å®¤</option>
                                <option value="home_living">è‡ªå®…ãƒªãƒ“ãƒ³ã‚°</option>
                                <option value="home_bedroom">è‡ªå®…å¯å®¤</option>
                                <option value="pharmacy">è–¬å±€</option>
                                <option value="clinic">ã‚¯ãƒªãƒ‹ãƒƒã‚¯</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>BGM</label>
                            <select id="sceneBgm">
                                <option value="main_theme">ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ</option>
                                <option value="daily">æ—¥å¸¸</option>
                                <option value="medical">åŒ»ç™‚ãƒ»ç·Šå¼µ</option>
                                <option value="heartwarming">å¿ƒæ¸©ã¾ã‚‹</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>ã‚«ãƒƒãƒˆä¸€è¦§</h2>
                    <div class="cut-list" id="cutList">
                        <div style="padding: 20px; text-align: center; color: #999;">
                            ã‚·ãƒ¼ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„
                        </div>
                    </div>
                    <button class="add-btn" onclick="addCut()" style="margin-top: 15px;">+ ã‚«ãƒƒãƒˆã‚’è¿½åŠ </button>
                </div>

                <div class="card">
                    <h2>çŸ¥è­˜è§£èª¬</h2>
                    <div class="form-group">
                        <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
                        <input type="text" id="knowledgeTitle" placeholder="ä¾‹ï¼šCOPDã¨ã¯">
                    </div>
                    <div class="form-group">
                        <label>æœ¬æ–‡</label>
                        <textarea id="knowledgeText" placeholder="ã€ãƒã‚¤ãƒ³ãƒˆ1ã€‘&#10;ãƒ»é …ç›®1&#10;ãƒ»é …ç›®2"></textarea>
                    </div>
                </div>

                <div class="card">
                    <h2>ã‚¯ã‚¤ã‚º</h2>
                    <div class="form-group">
                        <label>å•é¡Œæ–‡</label>
                        <input type="text" id="quizQuestion" placeholder="ä¾‹ï¼šCOPDæ‚£è€…ã®é…¸ç´ ç™‚æ³•ã§æ­£ã—ã„ã®ã¯ã©ã‚Œã‹ï¼Ÿ">
                    </div>
                    <div class="form-group">
                        <label>é¸æŠè‚¢ï¼ˆæ­£è§£ã«ãƒã‚§ãƒƒã‚¯ï¼‰</label>
                        <div class="quiz-option">
                            <input type="checkbox" id="quizCorrect1">
                            <input type="text" id="quizOption1" placeholder="é¸æŠè‚¢1">
                        </div>
                        <div class="quiz-option">
                            <input type="checkbox" id="quizCorrect2">
                            <input type="text" id="quizOption2" placeholder="é¸æŠè‚¢2">
                        </div>
                        <div class="quiz-option">
                            <input type="checkbox" id="quizCorrect3">
                            <input type="text" id="quizOption3" placeholder="é¸æŠè‚¢3">
                        </div>
                        <div class="quiz-option">
                            <input type="checkbox" id="quizCorrect4">
                            <input type="text" id="quizOption4" placeholder="é¸æŠè‚¢4">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ– -->
            <div id="previewTab" class="tab-content">
                <div class="card">
                    <h2>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                    <div class="preview-container">
                        <div class="preview-bg" id="previewBg"></div>
                        <div class="preview-dialog">
                            <span class="preview-speaker" id="previewSpeaker">ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</span>
                            <div class="preview-text" id="previewText">
                                ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã‚«ãƒƒãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center;">
                        <button class="btn btn-secondary" onclick="prevCut()">â† å‰ã¸</button>
                        <button class="btn btn-primary" onclick="nextCut()">æ¬¡ã¸ â†’</button>
                    </div>
                </div>

                <div class="card">
                    <h2>JSONå‡ºåŠ›</h2>
                    <div class="json-output" id="jsonOutput">{}</div>
                    <button class="btn btn-primary" style="margin-top: 15px;" onclick="copyJSON()">JSONã‚’ã‚³ãƒ”ãƒ¼</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚«ãƒƒãƒˆç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal-overlay" id="cutModal">
        <div class="modal">
            <h3>ã‚«ãƒƒãƒˆç·¨é›†</h3>
            <div class="form-group">
                <label>è©±è€…</label>
                <select id="cutSpeaker">
                    <option value="narration">ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</option>
                </select>
            </div>
            <div class="form-group">
                <label>ã‚¿ã‚¤ãƒ—</label>
                <select id="cutType">
                    <option value="dialogue">ã‚»ãƒªãƒ•</option>
                    <option value="narration">ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</option>
                    <option value="thought">å¿ƒã®å£°</option>
                </select>
            </div>
            <div class="form-group">
                <label>ã‚»ãƒªãƒ•ãƒ»ãƒ†ã‚­ã‚¹ãƒˆ</label>
                <textarea id="cutText" rows="4"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeCutModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-primary" onclick="saveCut()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal-overlay" id="characterModal">
        <div class="modal">
            <h3>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¿½åŠ </h3>
            <div class="form-row">
                <div class="form-group">
                    <label>IDï¼ˆè‹±æ•°å­—ï¼‰</label>
                    <input type="text" id="charId" placeholder="ä¾‹ï¼šyamada">
                </div>
                <div class="form-group">
                    <label>åå‰</label>
                    <input type="text" id="charName" placeholder="ä¾‹ï¼šå±±ç”°çœ‹è­·å¸«">
                </div>
            </div>
            <div class="form-group">
                <label>å½¹å‰²</label>
                <select id="charRole">
                    <option value="patient">æ‚£è€…</option>
                    <option value="family">å®¶æ—</option>
                    <option value="nurse">çœ‹è­·å¸«</option>
                    <option value="doctor">åŒ»å¸«</option>
                    <option value="pharmacist">è–¬å‰¤å¸«</option>
                    <option value="careManager">ã‚±ã‚¢ãƒãƒã‚¸ãƒ£ãƒ¼</option>
                    <option value="other">ãã®ä»–</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeCharacterModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-primary" onclick="saveCharacter()">è¿½åŠ </button>
            </div>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
        let projectData = {
            meta: {
                title: "",
                subtitle: "",
                targetAudience: "",
                author: ""
            },
            patient: {
                name: "",
                age: 0,
                gender: "ç”·æ€§",
                diagnosis: "",
                treatment: ""
            },
            theme: {
                primaryColor: "#2d5a27",
                accentColor: "#8bc34a"
            },
            characters: [],
            scenes: []
        };

        let currentSceneIndex = -1;
        let currentCutIndex = -1;
        let editingCutIndex = -1;

        // åˆæœŸåŒ–
        function init() {
            updateSceneList();
            updateCharacterList();
            updateSpeakerOptions();
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');

            if (tabName === 'preview') {
                updateJSONOutput();
                updatePreview();
            }
        }

        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³æŠ˜ã‚ŠãŸãŸã¿
        function toggleSection(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('span');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.textContent = 'â–¼';
            } else {
                content.style.display = 'none';
                arrow.textContent = 'â–¶';
            }
        }

        // ã‚·ãƒ¼ãƒ³è¿½åŠ 
        function addScene() {
            const sceneNum = projectData.scenes.length + 1;
            projectData.scenes.push({
                id: sceneNum,
                title: `ã‚·ãƒ¼ãƒ³${sceneNum}`,
                background: "",
                bgm: "daily",
                cuts: [],
                knowledge: { title: "", text: "" },
                quiz: null
            });
            updateSceneList();
            selectScene(projectData.scenes.length - 1);
        }

        // ã‚·ãƒ¼ãƒ³é¸æŠ
        function selectScene(index) {
            currentSceneIndex = index;
            currentCutIndex = 0;

            document.querySelectorAll('.scene-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });

            const scene = projectData.scenes[index];
            document.getElementById('sceneTitle').value = scene.title;
            document.getElementById('sceneBackground').value = scene.background || "";
            document.getElementById('sceneBgm').value = scene.bgm || "daily";
            document.getElementById('knowledgeTitle').value = scene.knowledge?.title || "";
            document.getElementById('knowledgeText').value = scene.knowledge?.text || "";

            // ã‚¯ã‚¤ã‚º
            if (scene.quiz) {
                document.getElementById('quizQuestion').value = scene.quiz.question || "";
                scene.quiz.options?.forEach((opt, i) => {
                    document.getElementById('quizOption' + (i + 1)).value = opt.text || "";
                    document.getElementById('quizCorrect' + (i + 1)).checked = opt.correct || false;
                });
            } else {
                document.getElementById('quizQuestion').value = "";
                for (let i = 1; i <= 4; i++) {
                    document.getElementById('quizOption' + i).value = "";
                    document.getElementById('quizCorrect' + i).checked = false;
                }
            }

            updateCutList();
            switchTab('scene');
        }

        // ã‚·ãƒ¼ãƒ³ãƒªã‚¹ãƒˆæ›´æ–°
        function updateSceneList() {
            const list = document.getElementById('sceneList');
            list.innerHTML = projectData.scenes.map((scene, i) => `
                <li class="scene-item ${i === currentSceneIndex ? 'active' : ''}" onclick="selectScene(${i})">
                    <span><span class="scene-num">${scene.id}</span> ${scene.title}</span>
                    <span style="color:#999">${scene.cuts.length}ã‚«ãƒƒãƒˆ</span>
                </li>
            `).join('');
        }

        // ã‚«ãƒƒãƒˆãƒªã‚¹ãƒˆæ›´æ–°
        function updateCutList() {
            const list = document.getElementById('cutList');
            if (currentSceneIndex < 0) {
                list.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">ã‚·ãƒ¼ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„</div>';
                return;
            }

            const scene = projectData.scenes[currentSceneIndex];
            if (scene.cuts.length === 0) {
                list.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">ã‚«ãƒƒãƒˆãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            list.innerHTML = scene.cuts.map((cut, i) => `
                <div class="cut-item ${i === currentCutIndex ? 'active' : ''}" onclick="selectCut(${i})">
                    <div class="cut-header">
                        <span><span class="cut-id">${cut.id}</span></span>
                        <span class="cut-speaker">${getSpeakerName(cut.speaker)}</span>
                    </div>
                    <div class="cut-text">${cut.text}</div>
                    <div class="cut-actions" onclick="event.stopPropagation()">
                        <button class="edit-btn" onclick="editCut(${i})">ç·¨é›†</button>
                        <button class="delete-btn" onclick="deleteCut(${i})">å‰Šé™¤</button>
                    </div>
                </div>
            `).join('');
        }

        // è©±è€…åå–å¾—
        function getSpeakerName(speakerId) {
            if (speakerId === 'narration') return 'ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³';
            if (speakerId === 'thought') return 'å¿ƒã®å£°';
            const char = projectData.characters.find(c => c.id === speakerId);
            return char ? char.name : speakerId;
        }

        // ã‚«ãƒƒãƒˆé¸æŠ
        function selectCut(index) {
            currentCutIndex = index;
            updateCutList();
            updatePreview();
        }

        // ã‚«ãƒƒãƒˆè¿½åŠ 
        function addCut() {
            if (currentSceneIndex < 0) {
                alert('å…ˆã«ã‚·ãƒ¼ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            editingCutIndex = -1;
            document.getElementById('cutSpeaker').value = 'narration';
            document.getElementById('cutType').value = 'dialogue';
            document.getElementById('cutText').value = '';
            document.getElementById('cutModal').classList.add('active');
        }

        // ã‚«ãƒƒãƒˆç·¨é›†
        function editCut(index) {
            editingCutIndex = index;
            const cut = projectData.scenes[currentSceneIndex].cuts[index];
            document.getElementById('cutSpeaker').value = cut.speaker;
            document.getElementById('cutType').value = cut.type || 'dialogue';
            document.getElementById('cutText').value = cut.text;
            document.getElementById('cutModal').classList.add('active');
        }

        // ã‚«ãƒƒãƒˆä¿å­˜
        function saveCut() {
            const scene = projectData.scenes[currentSceneIndex];
            const cutData = {
                id: `s${String(scene.id).padStart(2, '0')}_${String(scene.cuts.length + 1).padStart(2, '0')}`,
                speaker: document.getElementById('cutSpeaker').value,
                type: document.getElementById('cutType').value,
                text: document.getElementById('cutText').value
            };

            if (editingCutIndex >= 0) {
                cutData.id = scene.cuts[editingCutIndex].id;
                scene.cuts[editingCutIndex] = cutData;
            } else {
                scene.cuts.push(cutData);
            }

            closeCutModal();
            updateCutList();
            updateSceneList();
        }

        // ã‚«ãƒƒãƒˆå‰Šé™¤
        function deleteCut(index) {
            if (confirm('ã“ã®ã‚«ãƒƒãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                projectData.scenes[currentSceneIndex].cuts.splice(index, 1);
                // IDã‚’æŒ¯ã‚Šç›´ã—
                projectData.scenes[currentSceneIndex].cuts.forEach((cut, i) => {
                    cut.id = `s${String(projectData.scenes[currentSceneIndex].id).padStart(2, '0')}_${String(i + 1).padStart(2, '0')}`;
                });
                updateCutList();
                updateSceneList();
            }
        }

        function closeCutModal() {
            document.getElementById('cutModal').classList.remove('active');
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç®¡ç†
        function openCharacterModal() {
            document.getElementById('charId').value = '';
            document.getElementById('charName').value = '';
            document.getElementById('charRole').value = 'nurse';
            document.getElementById('characterModal').classList.add('active');
        }

        function closeCharacterModal() {
            document.getElementById('characterModal').classList.remove('active');
        }

        function saveCharacter() {
            const char = {
                id: document.getElementById('charId').value,
                name: document.getElementById('charName').value,
                role: document.getElementById('charRole').value
            };
            if (!char.id || !char.name) {
                alert('IDã¨åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            projectData.characters.push(char);
            closeCharacterModal();
            updateCharacterList();
            updateSpeakerOptions();
        }

        function updateCharacterList() {
            const list = document.getElementById('characterList');
            list.innerHTML = projectData.characters.map((char, i) => `
                <li class="scene-item">
                    <span>ğŸ‘¤ ${char.name}</span>
                    <span style="color:#999; font-size:0.8em">${char.role}</span>
                </li>
            `).join('');
        }

        function updateSpeakerOptions() {
            const select = document.getElementById('cutSpeaker');
            select.innerHTML = `
                <option value="narration">ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</option>
                <option value="thought">å¿ƒã®å£°</option>
                ${projectData.characters.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
            `;
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
        function updatePreview() {
            if (currentSceneIndex < 0 || currentCutIndex < 0) return;

            const scene = projectData.scenes[currentSceneIndex];
            const cut = scene.cuts[currentCutIndex];

            if (!cut) return;

            document.getElementById('previewSpeaker').textContent = getSpeakerName(cut.speaker);
            document.getElementById('previewText').textContent = cut.text;

            // èƒŒæ™¯è‰²ã®ç°¡æ˜“å¯¾å¿œ
            const bgColors = {
                'hospital_room': '#4a6fa5',
                'home_living': '#8b7355',
                'home_bedroom': '#6b8e6b',
                'pharmacy': '#5f9ea0',
                'clinic': '#708090'
            };
            const bgEl = document.getElementById('previewBg');
            bgEl.style.backgroundColor = bgColors[scene.background] || '#2d2d44';
        }

        function prevCut() {
            if (currentCutIndex > 0) {
                selectCut(currentCutIndex - 1);
            }
        }

        function nextCut() {
            const scene = projectData.scenes[currentSceneIndex];
            if (scene && currentCutIndex < scene.cuts.length - 1) {
                selectCut(currentCutIndex + 1);
            }
        }

        // JSONå‡ºåŠ›
        function updateJSONOutput() {
            // ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
            projectData.meta.title = document.getElementById('projectTitle').value;
            projectData.meta.subtitle = document.getElementById('projectSubtitle').value;
            projectData.meta.targetAudience = document.getElementById('projectAudience').value;
            projectData.meta.author = document.getElementById('projectAuthor').value;

            projectData.patient.name = document.getElementById('patientName').value;
            projectData.patient.age = parseInt(document.getElementById('patientAge').value) || 0;
            projectData.patient.gender = document.getElementById('patientGender').value;
            projectData.patient.diagnosis = document.getElementById('patientDiagnosis').value;
            projectData.patient.treatment = document.getElementById('patientTreatment').value;

            projectData.theme.primaryColor = document.getElementById('primaryColor').value;
            projectData.theme.accentColor = document.getElementById('accentColor').value;

            // ç¾åœ¨ã®ã‚·ãƒ¼ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            if (currentSceneIndex >= 0) {
                const scene = projectData.scenes[currentSceneIndex];
                scene.title = document.getElementById('sceneTitle').value;
                scene.background = document.getElementById('sceneBackground').value;
                scene.bgm = document.getElementById('sceneBgm').value;
                scene.knowledge = {
                    title: document.getElementById('knowledgeTitle').value,
                    text: document.getElementById('knowledgeText').value
                };

                // ã‚¯ã‚¤ã‚º
                const quizQuestion = document.getElementById('quizQuestion').value;
                if (quizQuestion) {
                    scene.quiz = {
                        question: quizQuestion,
                        options: []
                    };
                    for (let i = 1; i <= 4; i++) {
                        const text = document.getElementById('quizOption' + i).value;
                        if (text) {
                            scene.quiz.options.push({
                                text: text,
                                correct: document.getElementById('quizCorrect' + i).checked
                            });
                        }
                    }
                }
            }

            const output = document.getElementById('jsonOutput');
            output.textContent = JSON.stringify(projectData, null, 2);
        }

        function copyJSON() {
            updateJSONOutput();
            const json = document.getElementById('jsonOutput').textContent;
            navigator.clipboard.writeText(json).then(() => {
                alert('JSONã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            });
        }

        function exportJSON() {
            updateJSONOutput();
            const json = document.getElementById('jsonOutput').textContent;
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'scenario.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importJSON() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try {
                        projectData = JSON.parse(ev.target.result);
                        loadDataToForm();
                        alert('JSONã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
                    } catch (err) {
                        alert('JSONã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function loadDataToForm() {
            document.getElementById('projectTitle').value = projectData.meta?.title || '';
            document.getElementById('projectSubtitle').value = projectData.meta?.subtitle || '';
            document.getElementById('projectAudience').value = projectData.meta?.targetAudience || '';
            document.getElementById('projectAuthor').value = projectData.meta?.author || '';

            document.getElementById('patientName').value = projectData.patient?.name || '';
            document.getElementById('patientAge').value = projectData.patient?.age || '';
            document.getElementById('patientGender').value = projectData.patient?.gender || 'ç”·æ€§';
            document.getElementById('patientDiagnosis').value = projectData.patient?.diagnosis || '';
            document.getElementById('patientTreatment').value = projectData.patient?.treatment || '';

            document.getElementById('primaryColor').value = projectData.theme?.primaryColor || '#2d5a27';
            document.getElementById('accentColor').value = projectData.theme?.accentColor || '#8bc34a';

            updateSceneList();
            updateCharacterList();
            updateSpeakerOptions();
        }

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadSample() {
            projectData = {
                meta: {
                    title: "åœ¨å®…ç™‚é¤Šã‚’æ”¯ãˆã‚‹è¨ªå•çœ‹è­·",
                    subtitle: "COPDäº‹ä¾‹",
                    targetAudience: "çœ‹è­·å­¦ç”Ÿãƒ»è¨ªå•çœ‹è­·å¸«",
                    author: "è–éš·ã‚¯ãƒªã‚¹ãƒˆãƒ•ã‚¡ãƒ¼å¤§å­¦"
                },
                patient: {
                    name: "è–éš·ä¸€ç”·",
                    age: 78,
                    gender: "ç”·æ€§",
                    diagnosis: "COPDï¼ˆæ…¢æ€§é–‰å¡æ€§è‚ºç–¾æ‚£ï¼‰",
                    treatment: "åœ¨å®…é…¸ç´ ç™‚æ³•ï¼ˆå®‰é™æ™‚2Lã€åŠ´ä½œæ™‚4Lï¼‰"
                },
                theme: {
                    primaryColor: "#2d5a27",
                    accentColor: "#8bc34a"
                },
                characters: [
                    { id: "kazuo", name: "è–éš·ä¸€ç”·", role: "patient" },
                    { id: "ichiko", name: "å¸‚å­", role: "family" },
                    { id: "yamada", name: "å±±ç”°çœ‹è­·å¸«", role: "nurse" },
                    { id: "doctor", name: "ä¸»æ²»åŒ»", role: "doctor" }
                ],
                scenes: [
                    {
                        id: 1,
                        title: "ã‚¤ãƒ³ãƒˆãƒ­",
                        background: "",
                        bgm: "main_theme",
                        cuts: [
                            { id: "s01_01", speaker: "narration", type: "narration", text: "ä»Šå›ã®ä¸»äººå…¬ã¯è–éš·ä¸€ç”·ã•ã‚“ã€78æ­³ã®ç”·æ€§ã§ã™ã€‚" },
                            { id: "s01_02", speaker: "narration", type: "narration", text: "3å¹´å‰ã«COPDã¨è¨ºæ–­ã•ã‚Œã€åœ¨å®…é…¸ç´ ç™‚æ³•ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚" }
                        ],
                        knowledge: {
                            title: "COPDã¨ã¯",
                            text: "COPDï¼ˆæ…¢æ€§é–‰å¡æ€§è‚ºç–¾æ‚£ï¼‰ã¯ã€ã‚¿ãƒã‚³ç…™ãªã©ã®æœ‰å®³ç‰©è³ªã‚’é•·æœŸã«å¸å…¥ã™ã‚‹ã“ã¨ã§ç”Ÿã˜ã‚‹è‚ºã®ç‚ç—‡æ€§ç–¾æ‚£ã§ã™ã€‚"
                        },
                        quiz: null
                    },
                    {
                        id: 2,
                        title: "é€€é™¢å‰ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹",
                        background: "hospital_room",
                        bgm: "medical",
                        cuts: [
                            { id: "s02_01", speaker: "doctor", type: "dialogue", text: "è–éš·ã•ã‚“ã€å…¥é™¢ä¸­ã®æ²»ç™‚ã§ç—‡çŠ¶ã¯æ”¹å–„ã—ã¾ã—ãŸã€‚" },
                            { id: "s02_02", speaker: "kazuo", type: "thought", text: "ï¼ˆå¿ƒã®å£°ï¼‰ã‚„ã£ã±ã‚Šæ‚ªããªã£ã¦ã„ã‚‹ã®ã‹..." }
                        ],
                        knowledge: {
                            title: "NPPVã¨ã¯",
                            text: "NPPVï¼ˆéä¾µè¥²çš„é™½åœ§æ›æ°—ç™‚æ³•ï¼‰ã¯ã€ãƒã‚¹ã‚¯ã‚’ä»‹ã—ã¦å‘¼å¸ã‚’è£œåŠ©ã™ã‚‹æ²»ç™‚æ³•ã§ã™ã€‚"
                        },
                        quiz: {
                            question: "COPDæ€¥æ€§å¢—æ‚ªæ™‚ã«æœ€åˆã«é¸æŠã•ã‚Œã‚‹æ²»ç™‚ã¯ï¼Ÿ",
                            options: [
                                { text: "æ°—ç®¡æŒ¿ç®¡", correct: false },
                                { text: "NPPV", correct: true },
                                { text: "é«˜æµé‡é…¸ç´ ", correct: false },
                                { text: "ãƒãƒ–ãƒ©ã‚¤ã‚¶ãƒ¼", correct: false }
                            ]
                        }
                    }
                ]
            };
            loadDataToForm();
            alert('ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        init();
    </script>
</body>
</html>
